pre-push:
  parallel: false
  commands:
    test-e2e:
      run: |
        # Fetch the latest state from the remote
        git fetch origin

        # Get the list of files changed between the remote and local branch
        CHANGED_FILES=$(git diff --name-only FETCH_HEAD...HEAD)

        # If there are changes in the pet-guardian-app folder, run e2e tests
        if echo "$CHANGED_FILES" | grep -q "apps/pet-guardian-app/"; then
          echo "üîç Changes detected in pet-guardian-app. Running e2e tests..."
          cd apps/pet-guardian-app
          export $(grep -v '^#' .env.test | xargs)
          pnpm dev:test &
          DEV_PID=$!
          sleep 10
          export $(grep -v '^#' .env.test | xargs)
          pnpm test:e2e
          KILL_EXIT=$?
          kill $DEV_PID
          exit $KILL_EXIT
        else
          echo "‚úÖ No changes in pet-guardian-app. Skipping e2e tests."
          exit 0
        fi
